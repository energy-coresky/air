
#.dev_tools =========================================================================
const: @csv( ) __DIR__ __FILE__ __LINE__ __FUNCTION__ __CLASS__ __METHOD__ __NAMESPACE__ __TRAIT__

keywords: @csv( )
  __halt_compiler abstract and array as break callable case catch class clone const continue
  declare default die do echo else elseif empty enddeclare endfor endforeach endif endswitch
  endwhile eval exit extends final for foreach function global goto if implements include
  include_once instanceof insteadof interface isset list namespace new or print private protected
  public require require_once return static switch throw trait try unset use var while xor
  match readonly fn yield # 'yield from'

extension: @csv( )
  apache2handler bcmath bz2 calendar cgi-fcgi COM* Core ctype curl date dba dom enchant
  exif FFI* fileinfo filter ftp gd gettext gmp hash HRTime* iconv imagick imap interbase
  intl ionCube Loader json ldap libxml mbstring mhash* mysqli mysqlnd oci8 odbc openssl pcntl*
  pcre PDO PDO_CUBRID PDO_DBLIB PDO_FIREBIRD PDO_IBM PDO_INFORMIX pdo_mysql PDO_OCI PDO_ODBC pdo_pgsql
  pdo_sqlite PDO_SQLSRV pgsql Phar phpdbg* posix* pspell readline Reflection session shmop
  SimpleXML snmp soap sockets sodium SourceGuardian SPL sqlite3 standard sysvmsg* sysvsem* sysvshm*
  tidy tokenizer wddx xml xmlreader xmlwriter xsl Zend OPcache zip zlib

coresky:   https://coresky.net/api
packagist: https://repo.packagist.org/p2/
#.dev_tools

#.languages =========================================================================
+ @bang(. ) >
  ab.Abkhazian aa.Afar af.Afrikaans ak.Akan sq.Albanian am.Amharic ar.Arabic an.Aragonese hy.Armenian as.Assamese
  av.Avaric ae.Avestan ay.Aymara az.Azerbaijani bm.Bambara ba.Bashkir eu.Basque be.Belarusian bn.Bengali bh.Bihari
  bi.Bislama bs.Bosnian br.Breton bg.Bulgarian my.Burmese ca.Catalan km.Central_Khmer ch.Chamorro ce.Chechen ny.Chichewa
  zh.Chinese cu.Church_Slavic cv.Chuvash kw.Cornish co.Corsican cr.Cree hr.Croatian cs.Czech da.Danish nl.Dutch
  dz.Dzongkha en.English eo.Esperanto et.Estonian ee.Ewe fo.Faroese fj.Fijian fi.Finnish fr.French ff.Fulah gd.Gaelic
  gl.Galician lg.Ganda ka.Georgian de.German el.Greek kl.Greenlandic gu.Gujarati ht.Haitian ha.Hausa he.Hebrew hz.Herero
  hi.Hindi ho.Hiri_Motu hu.Hungarian is.Icelandic io.Ido ig.Igbo id.Indonesian ia.Interlingua ie.Interlingue iu.Inuktitut
  ik.Inupiaq ga.Irish it.Italian ja.Japanese jv.Javanese kn.Kannada kr.Kanuri ks.Kashmiri kk.Kazakh ki.Kikuyu rw.Kinyarwanda
  ky.Kirghiz kv.Komi kg.Kongo ko.Korean kj.Kuanyama ku.Kurdish lo.Lao la.Latin lv.Latvian li.Limburgan ln.Lingala lt.Lithuanian
  lu.Luba-Katanga lb.Luxembourgish mk.Macedonian mg.Malagasy ms.Malay ml.Malayalam dv.Maldivian mt.Maltese gv.Manx mi.Maori
  mr.Marathi mh.Marshallese mn.Mongolian na.Nauru nv.Navaho ng.Ndonga ne.Nepali nd.North_Ndebele se.Northern_Sami no.Norwegian
  nb.Norwegian_Bokmål nn.Norwegian_Nynorsk ii.Nuosu oj.Ojibwa or.Oriya om.Oromo os.Ossetian pi.Pali pa.Panjabi ps.Pashto
  fa.Persian pl.Polish pt.Portuguese qu.Quechua ro.Romanian rm.Romansh rn.Rundi ru.Russian sg.Sango sa.Sanskrit sc.Sardinian
  sr.Serbian sn.Shona sd.Sindhi si.Sinhala sk.Slovak sl.Slovene so.Somali nr.South_Ndebele st.Southern_Sotho es.Spanish
  su.Sundanese sw.Swahili ss.Swati sv.Swedish tl.Tagalog ty.Tahitian tg.Tajik ta.Tamil tt.Tatar te.Telugu th.Thai
  bo.Tibetan ti.Tigrinya to.Tongan ts.Tsonga tn.Tswana tr.Turkish tk.Turkmen tw.Twi ug.Uighur uk.Ukrainian ur.Urdu
  uz.Uzbek ve.Venda vi.Vietnamese vo.Volapük wa.Walloon cy.Welsh fy.Western_Frisian wo.Wolof xh.Xhosa yi.Yiddish
  yo.Yoruba za.Zhuang zu.Zulu
#.languages


#.timezones =========================================================================
+ @csv( )
  Africa: Abidjan Accra Addis_Ababa Algiers Asmara Bamako Bangui Banjul Bissau Blantyre Brazzaville Bujumbura Cairo Ceuta Conakry Dakar Dar_es_Salaam Djibouti Douala Freetown Gaborone Harare Johannesburg Juba Kampala Khartoum Kigali Kinshasa Lagos Libreville Lome Luanda Lubumbashi Lusaka Malabo Maputo Maseru Mbabane Mogadishu Monrovia Nairobi Ndjamena Niamey Nouakchott Ouagadougou Porto-Novo Sao_Tome Tripoli Tunis Windhoek
  America: Adak Anchorage Anguilla Antigua Argentina/Buenos_Aires Argentina/Catamarca Argentina/Cordoba Argentina/Jujuy Argentina/La_Rioja Argentina/Mendoza Argentina/Rio_Gallegos Argentina/Salta Argentina/San_Juan Argentina/San_Luis Argentina/Tucuman Argentina/Ushuaia Aruba Asuncion Atikokan Bahia_Banderas Barbados Belize Blanc-Sablon Bogota Boise Cambridge_Bay Cancun Caracas Cayman Chicago Chihuahua Costa_Rica Creston Curacao Danmarkshavn Dawson Dawson_Creek Denver Detroit Dominica Edmonton El_Salvador Fort_Nelson Glace_Bay Goose_Bay Grand_Turk Grenada Guadeloupe Guatemala Guayaquil Halifax Havana Hermosillo Indiana/Indianapolis Indiana/Knox Indiana/Marengo Indiana/Petersburg Indiana/Tell_City Indiana/Vevay Indiana/Vincennes Indiana/Winamac Inuvik Iqaluit Jamaica Juneau Kentucky/Louisville Kentucky/Monticello Kralendijk La_Paz Los_Angeles Lower_Princes Managua Marigot Martinique Matamoros Mazatlan Menominee Merida Metlakatla Mexico_City Miquelon Moncton Monterrey Montevideo Montserrat Nassau New_York Nipigon Nome North_Dakota/Beulah North_Dakota/Center North_Dakota/New_Salem Ojinaga Panama Pangnirtung Paramaribo Phoenix Port-au-Prince Port_of_Spain Puerto_Rico Punta_Arenas Rainy_River Rankin_Inlet Regina Resolute Santiago Santo_Domingo Sitka St_Barthelemy St_Johns St_Kitts St_Lucia St_Thomas St_Vincent Swift_Current Tegucigalpa Thule Thunder_Bay Tijuana Toronto Tortola Vancouver Whitehorse Winnipeg Yakutat Yellowknife
  Antarctica: Macquarie McMurdo
  Arctic: Longyearbyen
  Asia: Amman Baghdad Bangkok Beirut Colombo Damascus Dhaka Famagusta Gaza Hebron Ho_Chi_Minh Hong_Kong Irkutsk Jakarta Jayapura Jerusalem Karachi Kolkata Kuala_Lumpur Macau Makassar Manila Nicosia Phnom_Penh Pontianak Pyongyang Seoul Shanghai Singapore Taipei Tbilisi Tehran Tokyo Vientiane Yangon Yekaterinburg
  Atlantic: Azores Bermuda Canary Faroe Madeira Reykjavik St_Helena Stanley
  Australia: Adelaide Brisbane Broken_Hill Darwin Hobart Lindeman Lord_Howe Melbourne Perth Sydney
  Europe: Amsterdam Andorra Athens Belgrade Berlin Bratislava Brussels Bucharest Budapest Busingen Chisinau Copenhagen Dublin Gibraltar Guernsey Helsinki Isle_of_Man Istanbul Jersey Kaliningrad Kiev Lisbon Ljubljana London Luxembourg Madrid Malta Mariehamn Minsk Monaco Moscow Oslo Paris Podgorica Prague Riga Rome San_Marino Sarajevo Simferopol Skopje Sofia Stockholm Tallinn Tirane Uzhgorod Vaduz Vatican Vienna Vilnius Warsaw Zagreb Zaporozhye Zurich
  Indian: Antananarivo Comoro Maldives Mayotte
  Pacific: Auckland Easter Guam Honolulu Midway Pago_Pago Saipan
#.timezones

#.system =========================================================================
- <fieldset><legend>Primary settings</legend>
- ['', [[<b><u>Production</u></b>, li]]]
trace_root: [Debug mode on production for `root` profile, chk]
trace_cli: [Use X-tracing for CLI, chk]
error_403: [Use 403 code for `die`, chk]
empty_die: [Empty response for `die`, chk]
gate_404: [Gate errors as 0.404 (soft), chk] #2do: clear all cache when changed
log_error: [Log ERROR, radio, [Off, On]]  #crash_log prod_error quiet_eerr
log_crash: [Log CRASH, radio, [Off, On]]
- [Hard cache, {
    cache_act: ['', radio, [Off, On]],
    cache_sec: ['Default TTL, seconds', number, style="width:100px", 300]
  }]
- </fieldset>
- <fieldset><legend>"Visitor's & users settings"</legend>
- [Cookie name, {
    c_name: ['', '', '', sky],
    c_upd: ['Cookie updates, minutes', number, style="width:100px", 60]
  }]
visit: [One visit break after, off minutes, number, '', 5]
reg_req: [Users required for registrations, radio, [Both, Login, E-mail]]
- </fieldset>
#.system

#.cron =========================================================================
clear_nc: ["Visitor's cleaning (no cookie), days", number, '', 2]
clear_hc: ["Visitor's cleaning (has cookie), days", number, '', 10]
clear_ua: ["Visitor's cleaning (authed), days", number, '', 1000]
#.cron

#.phpman =========================================================================
+ {en:English, pt_BR:Brazilian Portuguese,zh:Chinese (Simplified),fr:French,de:German,ja:Japanese,ru:Russian,es:Spanish,tr:Turkish}
#.phpman

#.dev_cfg =========================================================================
dev:  [Set debug=0 for DEV-tools, chk]
err:  [Show suppressed PHP errors, chk]
cron: [Run cron when click on DEV instance, chk]
lgt:  [SkyLang table name, '', size="25"]
manual: [PHP manual language, select, @inc(.phpman)]
se:   [Search engine tpl, '', size="50"]
nopopup: [No dev-tools on soft 404, chk]
crash_to: ['Crash-redirect timeout, sec', number, '', 8]
- @php Form::X([], '<hr>')
- ['Check static files for changes (file or path to *.js & *.css files), example: `m`', li]
static: ['', '', size="50"]
etc: ['Turn ON tracing for default_c::a_etc()', chk]
red_label: [Red label, radio, [Off, On]]
- [Save, submit]
#.dev_cfg

#.dev_app =========================================================================
- [Application, {
    app: ['', '', size="11"],
    ver: ['', number, style="width:77px" step="0.0001"],
    0: [@php(tag(SKY::version()['app'][3] . ' from ' . date('c', SKY::version()['app'][0]))) ?, ni]
  }]
- [Core, ni, @php SKY::CORE]
- [Save, submit]
#.dev_app

#.dev_form =========================================================================
form1: @php Form::A(array_combine($key, $val), yml('dev.app', '+ @inc(dev_app)'))
form2: @php Form::A(SKY::$mem['d'][3], yml('dev.cfg', '+ @inc(dev_cfg)'))
#.dev_form

#.library =========================================================================
+ @match(/^(\d) (\S+) (.*)$/s) # @scan(%d %s %[^^]) # %[^;])%[ -~]
  Main-page: |
    0 / $main = '' === $uri;
      if ($main || 'main' === $uri)
          return $surl = $main ? ['main'] : [];
  No-map-file: |
    0 file.map if ('.map' === substr($uri, -4))
      return $surl = ['etc', '_.map'];
  Dev-ends: |
    1 /_dev if ('_' == $sky->_0[0])
      return;
  Assets-coresky: |
    1 /m/{0} if ($cnt && 'etc' == $surl[0])
      return $surl[0] = '-';
      if ($cnt && 'm' == $surl[0])
      return $surl[0] = 'etc';
  Assets-wares: |
    1 /w/{1}/{0} if (3 == $cnt && 'w' == $surl[0]) {
        array_shift($surl);
        $surl[2] = $surl[0];
        return $surl[0] = 'etc';
    }
  Robots.txt: |
    0 /robots.txt if ('robots.txt' == $uri)
        return array_unshift($surl, 'etc');
  Swap-1-2: |
    0 /0/2/1 if ($cnt > 2) {
        $tmp = $surl[1];
        $surl[1] = $surl[2];
        $surl[2] = $tmp;
    }
  Additive: |
    0 /x if ($cnt && 'x' == $surl[0])
        $surl[0] = 'ctrl';
  Tune-ware: |
    0  if ($cnt && 'u' == $surl[0]) {
        common_c::$tune = array_shift($surl);
        $cnt--;
    }
  Pagination: |
    0 /ctrl/page-2/action if ($cnt > 2 && preg_match("/^page\-\d+$/", $surl[1])) {
        common_c::$page = (int)substr($surl[1], 5);
        array_splice($surl, 1, 1);
        $cnt--;
    }
  Url-html: |
    0 /c/a/page.html $ext = 'html';
    if ($cnt) {
        $a = explode('.', $p =& $surl[$cnt - 1]);
        $p = 2 == count($a) && $ext == $a[1] ? $a[0] : "$p.$ext";
    }
  Url-lang: |
    0 /en/c/a # take language from semantic url
    common_c::langs_h();
    if ($cnt && in_array($surl[0], $sky->langs)) {
        common_c::$lg = array_shift($surl);
        $cnt--;
    }
  Terminator: |
    0 /crash $lst = ['adm', 'api', 'crash', 'test_crash'];
    if ($cnt && in_array($surl[0], $lst))
        return;
  Reverse: |
    0 /dash-surl/a $rw = ['dash-surl' => 'nodash',];
    if ($cnt) {
        $rw += array_flip($rw);
        $p =& $surl[0];
        empty($rw[$p]) or $p = $rw[$p];
    }
#.library

#.first_run =========================================================================
+ @php |
  <?php # Auto generated "First-Run" file by Coresky framework
  
  function index(&$unlink = null) {
      $fp = fopen(__FILE__, 'r');
      fseek($fp, __COMPILER_HALT_OFFSET__);
      $code = stream_get_contents($fp);
      fclose($fp);
      if ($unlink)
          $unlink = @unlink(__FILE__);
      return ltrim($code);
  }
  
  $ary = {!var_export(explode(' ', $exts), true)!};
  $tests = [
      function () {
          return [
              'PHP version >= {{$vphp}}#if(SKY::i('and')) and <= {{$vph2}}#end',
              version_compare(PHP_VERSION, '{{$vphp}}', '>=')#if(SKY::i('and')) && version_compare(PHP_VERSION, '{{$vph2}}', '<=')#end,
          ];
      },
      function () use ($ary) {
          $ext = array_intersect($ary, get_loaded_extensions());
          return [
              $ext ? 'Extensions: ' . implode(', ', $ext) : false,
              true,
          ];
      },
      function () use ($ary) {
          $ext = array_diff($ary, get_loaded_extensions());
          return [
              $ext ? 'Extensions: ' . implode(', ', $ext) : false,
              false,
          ];
      },{!$tests!}
  
  ];
  $path = preg_replace("|[^/]*$|", '', $_SERVER['SCRIPT_NAME']);
  $uri = $_SERVER['REQUEST_URI'];
  $ok = 1;
  $list = [];
  foreach ($tests as $fun) {
      $fun = $fun($ok);
      if ($fun && $fun[0]) {
          $list[] = $fun;
          $ok &= (int)$fun[1];
      }
  }
  $anyway = $_GET && 'anw' == key($_GET) ? $_GET['anw'] : false;
  if ($ok || $anyway) {
      file_put_contents(__FILE__, index());
      header("Location: " . ($anyway ?: $uri));
      exit;
  }
  ?><!doctype html>
  <html>
  <head><title>{{SKY::version()['app'][3]}} application First-Run</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <link href="favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <style>
  #page {
      margin:8px auto 0 auto; width:600px; padding:5px 100px; border-bottom:2px solid lightblue; min-height:calc(100vh - 55px);
      background:white; font-family:arial, verdana; font-size: 90%;
  }
  #foo { margin:0 auto; width:790px; font-size:14px; padding:5px; background:white; text-align:center; }
  a, h1 { color: #3d7098; }
  h1 { font-size: 25px; margin-top:30px; border-bottom:4px solid #3d7098; }
  a:hover { text-decoration: none; color: white; background-color: #3d7098; }
  dl { width: 100%; margin:0; display:flex; border-bottom: 1px solid #ccc; }
  dt { width: 80%; margin:0; padding: 5px 0; }
  dd { width: 20%; margin:0; padding: 5px; }
  .fail { background:#fcc; } .ok { background:#cfc; }
  </style>
  </head>
  <body style="margin:0; display:inline-block; width:100%; background:lightblue;">
  <form method="post">
  <div id="page">
      <h1>{{SKY::version()['app'][4]}} application First-Run</h1>
      <?php foreach ($list as $v): ?>
      <dl>
          <dt><?php echo $v[0] ?></dt>
          <?php if($v2 = isset($v[2])): ?><dd><?php echo $v[2] ?></dd><?php else: ?>
          <dd class="<?php echo $v[1] ? 'ok' : 'fail' ?>"><?php echo $v[1] ? 'OK' : 'FAIL' ?></dd><?php endif ?>
      </dl>
      <?php endforeach; if (!$v2): ?>
      <div style="background:#ffc; margin:20px 0; padding:10px; border: 1px solid gold;">
          Please fix problem & test again
      </div>
      <button style="float:right" onclick="location.href='<?php echo "$path?anw=" . urlencode($uri) ?>'">Run app anyway</button>
      Problem fixed: <button onclick="location.href='<?php echo $uri ?>'">Test again</button><?php endif ?>
  </div>
  </form>
  <div id="foo">{{SKY::version()['app'][3]}} powered by {{SKY::version()['core'][0]}}.<a href="https://coresky.net/">Coresky</a> framework</div>
  </body>
  </html><?php
  
  __halt_compiler();
#.first_run

