#.jet core template

#._ errors for dev-tools
<h1>Error {{$sky->error_no}}</h1>
<pre>{!$tracing ?? ''!}</pre>
#._ magic marker used !


#.attach
+
<div class="other-task">
    <div class="fs16">Install {{$name}} ware:</div>
</div>
<form id="attach-ware">
<input type="hidden" name="s" value="prod.{{$dir}}">
<input type="hidden" name="mode" value="2">
<div class="" style="padding:10px;">
    <h1>Select classes:</h1>
    @loop($classes as $cls)
        <label><input type="checkbox" name="cls[]" value="{{$cls}}"> {{$cls}}</label><br>
    ~loop
    <input type="button" onclick="sky.d.attach(0,0, $('#attach-ware').serialize())" value="Install">
    <label><input type="checkbox" name="dev"> install for DEV mode only</label>
</div>
</form>
#.attach

#.ware //////////////////////////////////////////////////////////////////////////////
#use(`<h4>WALK ALL WARES..</h4>` as header)
<div class="other-task">
    <div class="fs16">Installed wares:</div>
</div>
<div class="bg-x" style="padding:10px">@php $bg_ware='' ~php
    @loop($e_installed)@eat
        @inc(.single)@empty<h1>No wares</h1>
    ~loop
</div><br>
<div class="other-task">
    <div class="fs16">Wares directory: wares/ + 
        <input name="dir" size="25" value="{{$sky->d_second_wares}}" placeholder="Second wares directory">
        <input type="button" value="Save" onclick="sky.d.second_dir(this)">
    </div>
    <div class="fs16" style="margin-left:10%">
        Create new ware: type
        <select>
            <option value="view">View</option>
            <option value="dev">Dev</option>
            <option value="prod">Prod</option>
        </select><button>Create</button>
    </div>
</div>
<div class="bg-y" style="padding:10px;">@php $bg_ware='#e0e7ff' ~php
    @loop($e_dir)@eat
        @inc(.single)@empty<h1>No wares</h1>
    ~loop
</div><br>
<div class="other-task">
    <div class="fs16">Wares in the Internet for <span style="text-transform:uppercase">{{DIR_M}}</span>.SKY. application:</div>
</div>
<div id="inet-wares" style="padding:10px;">
    <h1>Connecting ...</h1>
#.inet
#if(:-)
    @loop($e_inet)@eat
        @inc(.single)@empty<h1>No wares</h1>
    ~loop
#end
#.inet
<script>
  ajax('inet',{},'inet-wares');
</script>
</div>
#.ware.single ------------------------------------------------------------------------------
<div class="ware" style="background:{{$bg_ware}}">
    <h2>{{$row->name}}<sup>{{$row->type}}</sup></h2>
    <div class="were-desc">
        @if($row->desc){{$row->desc}}@else
            This ware don't has README.md file
        ~if
    </div>
    <div style="height:50px">
        @if($row->cnt ?? 0)
            Classes ({{$row->cnt}}):<br>
            &nbsp; <b>{{$row->class[0]}}</b><br>
            @if($row->cnt>1)&nbsp; <b>{{$row->class[1]}}</b>~if
            @if($row->cnt>2)...~if
        ~if
    </div>
    <div style="width:150px;position:relative;top:0px">
    @if(!$bg_ware)
        <button onclick="sky.d.attach('{{$row->name}}','un')">Uninstall</button>
    @elseif('#e0e7ff' == $bg_ware)
        <button onclick="sky.d.attach('{{$row->type . '.' . $row->path}}',1)">Install</button>
    @else
        <button onclick="sky.d.download('{{$row->name}}')">Download</button>
    ~if
    </div>
</div>
#.single.wares_memu ------------------------------------------------------------------------------
    <br><div class="other-task">Wares</div>
    <a class="inner-menu"@active('_dev?ware' == URI) href="_dev?ware">Browse All..</a>
    @loop($y_wares as $uri => $name)
        <a href="{{$uri}}?ware"@active($uri == URI)>{{$name}}</a>
    ~loop
#.wares_memu


#.development //////////////////////////////////////////////////////////////////////////////
@use(`<h4><u>DEVELOPMENT</u> CONFIGURATION</h4>` as header)
<div style="padding:10px 0 0 10px">
<fieldset><legend>App name & versions</legend>
{! $form1 !}
</fieldset>
<fieldset><legend>DEV instance configuration, {{$_SERVER['REMOTE_ADDR']}}</legend>
{! $form2 !}
</fieldset>
</div>
#.development.pp.drop
#.pp
#.drop

#.m_header

#.main.m_header //////////////////////////////////////////////////////////////////////////////
@use(`<h4>{!$h4!}@if(6 == $sky->_2)@view(databases)~if</h4>` as header)
@use(.m_dev)
@if($sky->_2)
@if($sky->_2 < 7)
<div class="bg-wx bg-x" style="border-bottom:1px solid #4338ca;position:sticky; top:0px">
    @block(`` as menus)
</div>
~if
<div style="padding:10px 0 0 10px">
@if($menus = Root::run($sky->_2, $sky->_4 ?: 0))@use(`{!$menus!}` as menus)~if
</div>
<style>
#table, .fl {
    width:95%;
    margin-top:10px;
}
.bg-x a {
    padding: 0 10px;
    display: inline-block;
    line-height: 24px;
}
#phpinfo {
    border:0;
    width: 100%;
    height: calc(100vh - 110px);
}
</style>
<script>
$(function() {
    $('#sm-select').change(function() {
        $(this).parent().submit();
    });
});
</script>
@else
@inc(.development)
~if
#.main.m_dev ------------------------------------------------------------------------------
@loop(['Development'] + Root::$menu1 + Root::$menu2 as $i => $name)
    <a class="inner-menu" href="_dev?main={!$i!}"@active($i == $sky->_2)>{!$name!}</a>
~loop
#.m_dev


#.view //////////////////////////////////////////////////////////////////////////////
#use(.menu)
#use(`{!$header!}` as header)
@if($php){!$php!}@else
    {!$layout!}{!$body!}
~if
#.view.menu ------------------------------------------------------------------------------
    <br><div class="other-task">Views</div>
    @loop($list_views as $v)
        <a href="_dev?view={{$sky->_2}}&nv={{$_}}"@active($nv == $_)>{{"$v[0] $v[2]"}}</a>
        @if($nv == $_)
        @loop($list_menu as $k => $item)
            @continue(2 == $k && $v[7])
            <a href="_dev?view={{$sky->_2}}&nv={{$_}}&act={{$k}}"
                class="inner-menu"@active($k == ($sky->_6 ?: 0))>{!$item!}
            </a>
        ~loop
        ~if
    ~loop
#.menu

#.layout //////////////////////////////////////////////////////////////////////////////
@if($y_ware_dir)@use(`Ware` as bottom)~if
<!doctype html><html>
<head>@head<script>
    sky.a._0 = sky.a.div = '{{$sky->_0}}'; sky.a._1 = '{{$sky->_1}}'; sky.a.uri = '{{URI}}'; sky.d.dev = {{(int)$sky->d_dev}}
</script>
</head>
<body>
<div id="main">
<div id="v-head">
    <div style="width:126px"><a href="{{PATH . ($sky->d_last_page ?: '_dev')}}"@active('_trace'!=$sky->_0)>
        ▼ {{'ware'==@(explode('?', $sky->d_last_page))[1] ? 'Wares' : 'Tasks'}}</a><a
        @href(history.back())><span style="font-family:Verdana;">&#9668;</span> Back</a>
    </div>
    <div style="width:144px">
    @loop($_ < 4)<a @href(sky.d.trace({{"$_,'$y_page'"}},this))@active($_ == $y_tx)>{{$_ ? "X$_" : 'T0'}}</a>~loop
    </div>
    <div id="top-head" style="width:calc(100% - 380px)">@block(`` as header)</div>
    <div style="text-align:right; width:110px"><a @href(sky.d.close_box())>Esc - Close @inc(__img.x)</a></div>
</div>

<div id="v-menu">
#if('_trace'!=:0)
    <div class="other-task" style="position:sticky; top:0px">Tasks</div>
    @loop($y_tasks as $uri => $name)
        <a href="{{$uri}}"@active($sky->_0 == explode('?', $uri)[0] && !in_array($sky->_1, ['view', 'ware']))>{{$name}}</a>
        @if('_gate' == $uri)@block(`` as m_gate)
        @elseif('_lang?list' == $uri)@block(`` as m_lang)
        @elseif('_inst' == $uri)@block(`` as m_inst)
        @elseif('_glob' == explode('?', $uri)[0])@block(`` as m_glob)
        @elseif('_dev' == explode('?', $uri)[0])@block(`` as m_dev)
        ~if
    ~loop
    @if(in_array($sky->_0, ['_glob', '_lang', '_earth', '_mercury']) || 'view' == $sky->_1)
        <a href="_dev?ware">Browse All Wares</a>
    ~if
    <a @href(var x=this;ajax('',function(r) { sky.d.drop_cache(r,x) },'_drop'))>Drop All Cache</a>
    @block(.wares_memu as menu)
    <div id="dev-empty"></div>
#end
</div>

<div id="v-body">
    <div style="display:table-cell; width:inherit;" id="dev-{{$y_page}}">@inc(*)</div>
    @if('trace' != $y_page)<div style="display:none" id="dev-trace">{!$trace_x ?? ''!}</div>@else@use(.header)~if
</div>

<div id="v-tail">
    <span style="width:40%" id="master">?@block(`{{$y_ware_dir}}` as master)</span>
    <div style="width:35%" id="tpl-list">
        @block(bottom)
#.bottom --------
        <form method="post" style="display:inline-block"><input type="hidden" name="t0">
        <a n="v" @href(sky.d.view())@active('_dev?view=' == substr(URI, 0, 10))>
            ▲ Views (<span>?</span>)
        </a>&nbsp; &nbsp;
        <a n="s" href="#">
            ▲ SQLs (<span>?</span>)
        </a>&nbsp; &nbsp;
        <a n="c" href="#">▲ Classes (<span>?</span>)</a>
        </form>
#.bottom --------
        ~block
    </div>
    <div style="width:25%">
        <span></span>
        <span id="app-rb">{{SKY::version()['app'][3]}}</span>
    </div>
    <div id="tpl-list-copy" style="display:none">@inc(.bottom)</div>
</div>
</div>
@tail</body></html>
#.layout.header --------
<div class="fl"><span style="color:red;margin:0 10px;">See also</span>
<a href="{{PATH}}_dev?main=10">@inc(__lng.rar) Log Error</a>
<a href="{{PATH}}_gate">@inc(__lng.rar) SkyGate</a>
<a href="{{PATH}}_glob?report">@inc(__lng.rar) Globals Report</a>
</div>
@if($sky->d_dev)
    <div style="display:inline-block;line-height:27px !important;background:#cfc; padding:0 10px">{{SKY::version()['app'][3]}}</div>
@else
    <div style="display:inline-block;line-height:27px !important;background:#ccf; padding:0 10px">TOOLS.DEV.SKY</div>
~if
<a href="{{PATH}}_dev?main=0" style="font-family:Verdana;color:{{SKY::d('err')?'red':'#1b1'}}">&#9668;</a>
#.header


